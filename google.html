<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>BTC Testnet – Robusto</title>

<!-- LIBS (ordem correta) -->
<script src="https://unpkg.com/tiny-secp256k1@2.2.1/dist/index.min.js"></script>
<script src="https://unpkg.com/ecpair@2.1.0/dist/ecpair.min.js"></script>
<script src="https://unpkg.com/bitcoinjs-lib@6.1.0/browser.js"></script>

<style>
body {
  font-family: monospace;
  background: #020617;
  color: #e5e7eb;
  padding: 20px;
}
button {
  padding: 10px;
}
pre {
  background: #0f172a;
  padding: 10px;
  max-height: 600px;
  overflow: auto;
}
</style>
</head>
<body>

<h2>Gerador BTC Testnet (com fallback)</h2>

<button onclick="processar()">Processar Lista</button>

<pre id="saida"></pre>

<script>
const URL_LISTA =
  "https://raw.githubusercontent.com/paraguay10/py/main/lista.txt";

const ECPair = ECPairFactory(tinysecp);

// APIs TESTNET (fallback automático)
const APIS = [
  addr => `https://api.blockcypher.com/v1/btc/test3/addrs/${addr}/balance`,
  addr => `https://blockstream.info/testnet/api/address/${addr}`,
  addr => `https://sochain.com/api/v2/get_address_balance/BTCTEST/${addr}`
];

async function obterSaldo(address) {
  for (let api of APIS) {
    try {
      const r = await fetch(api(address));
      if (!r.ok) continue;
      const j = await r.json();

      // normalizações
      if (j.final_balance !== undefined) return j.final_balance / 1e8;
      if (j.chain_stats) return j.chain_stats.funded_txo_sum / 1e8;
      if (j.data?.confirmed_balance) return j.data.confirmed_balance;

    } catch (e) {
      continue;
    }
  }
  return "API_FALHOU";
}

async function processar() {
  const out = document.getElementById("saida");
  out.textContent = "Carregando lista...\n";

  const txt = await fetch(URL_LISTA).then(r => r.text());
  const linhas = txt.split("\n");

  out.textContent = "";

  for (let i = 0; i < linhas.length; i++) {
    const priv = linhas[i].trim();

    if (!/^[0-9a-fA-F]{64}$/.test(priv)) {
      out.textContent += `${i+1}) KEY INVÁLIDA\n`;
      continue;
    }

    try {
      const keyPair = ECPair.fromPrivateKey(
        Buffer.from(priv, "hex"),
        { network: bitcoin.networks.testnet }
      );

      const { address } = bitcoin.payments.p2pkh({
        pubkey: keyPair.publicKey,
        network: bitcoin.networks.testnet
      });

      const saldo = await obterSaldo(address);

      out.textContent +=
        `${i+1}) ${address} | saldo: ${saldo}\n`;

    } catch (e) {
      out.textContent += `${i+1}) ERRO CRIPTO\n`;
    }
  }
}
</script>

</body>
</html>
