<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>BTC REAL â€” Lista GitHub Otimizado</title>

<style>
body { font-family: Arial; background:#020617; color:#e5e7eb; padding:20px; }
h2 { color:#38bdf8; }
input { background:#020617; border:1px solid #1e293b; color:#e5e7eb; padding:6px; width:100%; margin-bottom:8px; }
button { background:#0a0f1c; border:1px solid #1e293b; color:#38bdf8; padding:6px; cursor:pointer; font-weight:bold; margin-bottom:8px; }
.stats { margin-top:10px; padding:10px; border:1px solid #1e293b; border-radius:6px; }
.match { margin-bottom:10px; border-bottom:1px solid #1e293b; padding-bottom:8px; white-space:pre-wrap; }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:12px; }
</style>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>emailjs.init("T9VhOTKyPdZJjjO7E");</script>

</head>
<body>

<h2>BTC REAL (Mainnet) â€” Otimizado</h2>

<label>ðŸ”½ EndereÃ§o para procurar</label>
<input id="searchAddr" placeholder="Digite endereÃ§o BTC">

<button id="btnProcessar">Processar Lista</button>
<button id="emailTeste">ðŸ“§ Enviar Email Teste</button>

<div class="stats" id="stats">
Gerados: 0<br>
Matches: 0<br>
Velocidade: 0 addr/s
</div>

<div id="matches">ðŸŽ¯ MATCHES:</div>
<div id="grid" class="grid"></div>

<script type="module">
import { getPublicKey } from "https://esm.sh/@noble/secp256k1@2.1.0";
import { sha256 } from "https://esm.sh/@noble/hashes@1.3.3/sha256";
import { ripemd160 } from "https://esm.sh/@noble/hashes@1.3.3/ripemd160";

const URL_LISTA = "https://raw.githubusercontent.com/paraguay10/py/main/lista.txt";
const ALPHABET="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";

/* BASE58 */
function base58(buf){
  let zeros=0;
  while(zeros<buf.length && buf[zeros]===0) zeros++;
  let num=BigInt("0x"+[...buf].map(b=>b.toString(16).padStart(2,"0")).join(""));
  let out="";
  while(num>0n){ out=ALPHABET[num%58n]+out; num/=58n; }
  return "1".repeat(zeros)+out;
}

/* CONSULTAR SALDO REAL */
async function consultarSaldo(address){
  try{
    const res = await fetch(`https://blockstream.info/api/address/${address}`);
    if(!res.ok) return null;
    const data = await res.json();
    const funded = (data.chain_stats?.funded_txo_sum || 0) + (data.mempool_stats?.funded_txo_sum || 0);
    const spent = (data.chain_stats?.spent_txo_sum || 0) + (data.mempool_stats?.spent_txo_sum || 0);
    return (funded-spent)/1e8;
  } catch { return null; }
}

/* ENVIAR EMAIL */
async function enviarEmail(dados, tipo="MATCH"){
  const saldo = await consultarSaldo(dados.P2PKH);
  const content = `${tipo}

PRIVATE_KEY: ${dados.privHex}

MAINNET:
P2PKH: ${dados.P2PKH}
P2SH: ${dados.P2SH}
P2WPKH: ${dados.P2WPKH}

SALDO P2PKH: ${saldo !== null ? saldo+" BTC" : "Erro"}`;

  emailjs.send("service_z6sug47","template_5fbrhhc",{
    name:"Sistema BTC",
    email:"match@sistema.com",
    message: content
  });
}

/* PROCESSAR LISTA */
const matchesOut=document.getElementById("matches");
const grid=document.getElementById("grid");
let totalMatches=0;
let totalGerados=0;

document.getElementById("btnProcessar").addEventListener("click", async()=>{
  matchesOut.innerHTML="";
  grid.innerHTML="";
  totalMatches=0;
  totalGerados=0;

  const txt = await fetch(URL_LISTA).then(r=>r.text());
  const linhas = txt.split(/\r?\n/).map(l=>l.trim()).filter(l=>l);

  const searchAddr = document.getElementById("searchAddr").value.trim();

  const promises = linhas.map(async (privHex, i) => {
    if(!/^[0-9a-fA-F]{64}$/.test(privHex)) return;

    try{
      const priv = Uint8Array.from(privHex.match(/.{2}/g).map(b=>parseInt(b,16)));
      const pub = getPublicKey(priv,true);
      const hash160 = ripemd160(sha256(pub));
      const payload = new Uint8Array([0x00,...hash160]);
      const checksum = sha256(sha256(payload)).slice(0,4);
      const P2PKH = base58(new Uint8Array([...payload,...checksum]));
      const P2SH = base58(new Uint8Array([0x05,...hash160,...sha256(sha256(new Uint8Array([0x05,...hash160]))).slice(0,4)]));
      const P2WPKH = P2PKH; // simplificaÃ§Ã£o

      totalGerados++;

      // Renderiza endereÃ§o imediatamente
      const divCard = document.createElement("div");
      divCard.className="match";
      divCard.textContent=`${i+1}) ${P2PKH} (${privHex})`;
      grid.appendChild(divCard);

      const dados={privHex,P2PKH,P2SH,P2WPKH};

      // Procura match ou saldo >0 em paralelo
      (async()=>{
        let isMatch=false;
        if(searchAddr && (searchAddr===P2PKH || searchAddr===P2SH || searchAddr===P2WPKH)){
          isMatch=true;
          totalMatches++;
          const div = document.createElement("div");
          div.className="match";
          div.textContent=`MATCH ENCONTRADO!\n${JSON.stringify(dados,null,2)}`;
          matchesOut.prepend(div);
          enviarEmail(dados,"MATCH ENCONTRADO");
        }

        const saldo = await consultarSaldo(P2PKH);
        if(saldo && saldo>0){
          isMatch=true;
          totalMatches++;
          const div = document.createElement("div");
          div.className="match";
          div.textContent=`SALDO >0!\n${JSON.stringify(dados,null,2)}\nSaldo: ${saldo} BTC`;
          matchesOut.prepend(div);
          enviarEmail(dados,"SALDO POSITIVO");
        }

      })();

      // Atualiza stats
      document.getElementById("stats").innerHTML=`Gerados: ${totalGerados}<br>Matches: ${totalMatches}`;

    } catch(e){
      console.log("Erro cripto:", e);
    }
  });

  // Espera todos os processos iniciados (nÃ£o bloqueia a UI)
  await Promise.all(promises);
});

/* EMAIL TESTE */
document.getElementById("emailTeste").addEventListener("click",()=>{
  alert("Email teste enviado!");
});
</script>

</body>
</html>
